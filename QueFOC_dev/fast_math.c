//
// Created by 24216 on 2022/12/21.
//

#include "fast_math.h"

#define SIN_TABLE_SIZE 1000
// 4*1001 Byte = 3.91 KB
const float sin_table [SIN_TABLE_SIZE+1] = {
        0.00000f,0.00157f,0.00314f,0.00471f,0.00628f,0.00785f,0.00942f,0.01100f,0.01257f,0.01414f,
        0.01571f,0.01728f,0.01885f,0.02042f,0.02199f,0.02356f,0.02513f,0.02670f,0.02827f,0.02984f,
        0.03141f,0.03298f,0.03455f,0.03612f,0.03769f,0.03926f,0.04083f,0.04240f,0.04397f,0.04554f,
        0.04711f,0.04868f,0.05024f,0.05181f,0.05338f,0.05495f,0.05652f,0.05809f,0.05965f,0.06122f,
        0.06279f,0.06436f,0.06593f,0.06749f,0.06906f,0.07063f,0.07219f,0.07376f,0.07533f,0.07689f,
        0.07846f,0.08002f,0.08159f,0.08316f,0.08472f,0.08629f,0.08785f,0.08942f,0.09098f,0.09254f,
        0.09411f,0.09567f,0.09724f,0.09880f,0.10036f,0.10192f,0.10349f,0.10505f,0.10661f,0.10817f,
        0.10973f,0.11130f,0.11286f,0.11442f,0.11598f,0.11754f,0.11910f,0.12066f,0.12222f,0.12377f,
        0.12533f,0.12689f,0.12845f,0.13001f,0.13156f,0.13312f,0.13468f,0.13623f,0.13779f,0.13935f,
        0.14090f,0.14246f,0.14401f,0.14557f,0.14712f,0.14867f,0.15023f,0.15178f,0.15333f,0.15488f,
        0.15643f,0.15799f,0.15954f,0.16109f,0.16264f,0.16419f,0.16574f,0.16728f,0.16883f,0.17038f,
        0.17193f,0.17348f,0.17502f,0.17657f,0.17812f,0.17966f,0.18121f,0.18275f,0.18429f,0.18584f,
        0.18738f,0.18892f,0.19047f,0.19201f,0.19355f,0.19509f,0.19663f,0.19817f,0.19971f,0.20125f,
        0.20279f,0.20433f,0.20586f,0.20740f,0.20894f,0.21047f,0.21201f,0.21354f,0.21508f,0.21661f,
        0.21814f,0.21968f,0.22121f,0.22274f,0.22427f,0.22580f,0.22733f,0.22886f,0.23039f,0.23192f,
        0.23345f,0.23497f,0.23650f,0.23802f,0.23955f,0.24108f,0.24260f,0.24412f,0.24565f,0.24717f,
        0.24869f,0.25021f,0.25173f,0.25325f,0.25477f,0.25629f,0.25781f,0.25932f,0.26084f,0.26236f,
        0.26387f,0.26539f,0.26690f,0.26842f,0.26993f,0.27144f,0.27295f,0.27446f,0.27597f,0.27748f,
        0.27899f,0.28050f,0.28201f,0.28351f,0.28502f,0.28652f,0.28803f,0.28953f,0.29104f,0.29254f,
        0.29404f,0.29554f,0.29704f,0.29854f,0.30004f,0.30154f,0.30304f,0.30453f,0.30603f,0.30752f,
        0.30902f,0.31051f,0.31200f,0.31350f,0.31499f,0.31648f,0.31797f,0.31946f,0.32094f,0.32243f,
        0.32392f,0.32540f,0.32689f,0.32837f,0.32986f,0.33134f,0.33282f,0.33430f,0.33578f,0.33726f,
        0.33874f,0.34022f,0.34169f,0.34317f,0.34464f,0.34612f,0.34759f,0.34906f,0.35053f,0.35201f,
        0.35347f,0.35494f,0.35641f,0.35788f,0.35935f,0.36081f,0.36228f,0.36374f,0.36520f,0.36666f,
        0.36812f,0.36958f,0.37104f,0.37250f,0.37396f,0.37542f,0.37687f,0.37833f,0.37978f,0.38123f,
        0.38268f,0.38413f,0.38558f,0.38703f,0.38848f,0.38993f,0.39137f,0.39282f,0.39426f,0.39571f,
        0.39715f,0.39859f,0.40003f,0.40147f,0.40291f,0.40434f,0.40578f,0.40721f,0.40865f,0.41008f,
        0.41151f,0.41295f,0.41438f,0.41580f,0.41723f,0.41866f,0.42009f,0.42151f,0.42293f,0.42436f,
        0.42578f,0.42720f,0.42862f,0.43004f,0.43146f,0.43287f,0.43429f,0.43570f,0.43712f,0.43853f,
        0.43994f,0.44135f,0.44276f,0.44417f,0.44557f,0.44698f,0.44838f,0.44979f,0.45119f,0.45259f,
        0.45399f,0.45539f,0.45679f,0.45818f,0.45958f,0.46097f,0.46237f,0.46376f,0.46515f,0.46654f,
        0.46793f,0.46932f,0.47070f,0.47209f,0.47347f,0.47486f,0.47624f,0.47762f,0.47900f,0.48038f,
        0.48175f,0.48313f,0.48450f,0.48588f,0.48725f,0.48862f,0.48999f,0.49136f,0.49273f,0.49409f,
        0.49546f,0.49682f,0.49819f,0.49955f,0.50091f,0.50227f,0.50362f,0.50498f,0.50633f,0.50769f,
        0.50904f,0.51039f,0.51174f,0.51309f,0.51444f,0.51579f,0.51713f,0.51847f,0.51982f,0.52116f,
        0.52250f,0.52384f,0.52517f,0.52651f,0.52785f,0.52918f,0.53051f,0.53184f,0.53317f,0.53450f,
        0.53583f,0.53715f,0.53848f,0.53980f,0.54112f,0.54244f,0.54376f,0.54508f,0.54639f,0.54771f,
        0.54902f,0.55034f,0.55165f,0.55296f,0.55426f,0.55557f,0.55688f,0.55818f,0.55948f,0.56078f,
        0.56208f,0.56338f,0.56468f,0.56597f,0.56727f,0.56856f,0.56985f,0.57114f,0.57243f,0.57372f,
        0.57501f,0.57629f,0.57757f,0.57885f,0.58013f,0.58141f,0.58269f,0.58397f,0.58524f,0.58651f,
        0.58779f,0.58906f,0.59032f,0.59159f,0.59286f,0.59412f,0.59538f,0.59665f,0.59790f,0.59916f,
        0.60042f,0.60168f,0.60293f,0.60418f,0.60543f,0.60668f,0.60793f,0.60918f,0.61042f,0.61167f,
        0.61291f,0.61415f,0.61539f,0.61662f,0.61786f,0.61909f,0.62033f,0.62156f,0.62279f,0.62402f,
        0.62524f,0.62647f,0.62769f,0.62891f,0.63013f,0.63135f,0.63257f,0.63379f,0.63500f,0.63621f,
        0.63742f,0.63863f,0.63984f,0.64105f,0.64225f,0.64346f,0.64466f,0.64586f,0.64706f,0.64825f,
        0.64945f,0.65064f,0.65183f,0.65302f,0.65421f,0.65540f,0.65659f,0.65777f,0.65895f,0.66013f,
        0.66131f,0.66249f,0.66367f,0.66484f,0.66601f,0.66718f,0.66835f,0.66952f,0.67069f,0.67185f,
        0.67301f,0.67417f,0.67533f,0.67649f,0.67765f,0.67880f,0.67995f,0.68110f,0.68225f,0.68340f,
        0.68455f,0.68569f,0.68683f,0.68797f,0.68911f,0.69025f,0.69139f,0.69252f,0.69365f,0.69478f,
        0.69591f,0.69704f,0.69817f,0.69929f,0.70041f,0.70153f,0.70265f,0.70377f,0.70488f,0.70600f,
        0.70711f,0.70822f,0.70932f,0.71043f,0.71154f,0.71264f,0.71374f,0.71484f,0.71594f,0.71703f,
        0.71813f,0.71922f,0.72031f,0.72140f,0.72248f,0.72357f,0.72465f,0.72573f,0.72681f,0.72789f,
        0.72897f,0.73004f,0.73112f,0.73219f,0.73326f,0.73432f,0.73539f,0.73645f,0.73751f,0.73857f,
        0.73963f,0.74069f,0.74174f,0.74279f,0.74385f,0.74489f,0.74594f,0.74699f,0.74803f,0.74907f,
        0.75011f,0.75115f,0.75218f,0.75322f,0.75425f,0.75528f,0.75631f,0.75734f,0.75836f,0.75938f,
        0.76041f,0.76143f,0.76244f,0.76346f,0.76447f,0.76548f,0.76649f,0.76750f,0.76851f,0.76951f,
        0.77051f,0.77151f,0.77251f,0.77351f,0.77450f,0.77550f,0.77649f,0.77748f,0.77846f,0.77945f,
        0.78043f,0.78141f,0.78239f,0.78337f,0.78434f,0.78532f,0.78629f,0.78726f,0.78823f,0.78919f,
        0.79016f,0.79112f,0.79208f,0.79303f,0.79399f,0.79494f,0.79590f,0.79685f,0.79779f,0.79874f,
        0.79968f,0.80063f,0.80157f,0.80251f,0.80344f,0.80438f,0.80531f,0.80624f,0.80717f,0.80809f,
        0.80902f,0.80994f,0.81086f,0.81178f,0.81269f,0.81361f,0.81452f,0.81543f,0.81634f,0.81725f,
        0.81815f,0.81905f,0.81995f,0.82085f,0.82175f,0.82264f,0.82353f,0.82442f,0.82531f,0.82620f,
        0.82708f,0.82796f,0.82884f,0.82972f,0.83060f,0.83147f,0.83234f,0.83321f,0.83408f,0.83494f,
        0.83581f,0.83667f,0.83753f,0.83839f,0.83924f,0.84009f,0.84094f,0.84179f,0.84264f,0.84349f,
        0.84433f,0.84517f,0.84601f,0.84684f,0.84768f,0.84851f,0.84934f,0.85017f,0.85099f,0.85182f,
        0.85264f,0.85346f,0.85428f,0.85509f,0.85591f,0.85672f,0.85753f,0.85833f,0.85914f,0.85994f,
        0.86074f,0.86154f,0.86234f,0.86313f,0.86392f,0.86471f,0.86550f,0.86629f,0.86707f,0.86785f,
        0.86863f,0.86941f,0.87018f,0.87096f,0.87173f,0.87250f,0.87326f,0.87403f,0.87479f,0.87555f,
        0.87631f,0.87706f,0.87782f,0.87857f,0.87932f,0.88006f,0.88081f,0.88155f,0.88229f,0.88303f,
        0.88377f,0.88450f,0.88523f,0.88596f,0.88669f,0.88741f,0.88814f,0.88886f,0.88958f,0.89029f,
        0.89101f,0.89172f,0.89243f,0.89314f,0.89384f,0.89454f,0.89525f,0.89594f,0.89664f,0.89734f,
        0.89803f,0.89872f,0.89941f,0.90009f,0.90077f,0.90146f,0.90213f,0.90281f,0.90348f,0.90416f,
        0.90483f,0.90549f,0.90616f,0.90682f,0.90748f,0.90814f,0.90880f,0.90945f,0.91011f,0.91076f,
        0.91140f,0.91205f,0.91269f,0.91333f,0.91397f,0.91461f,0.91524f,0.91587f,0.91650f,0.91713f,
        0.91775f,0.91838f,0.91900f,0.91962f,0.92023f,0.92085f,0.92146f,0.92207f,0.92267f,0.92328f,
        0.92388f,0.92448f,0.92508f,0.92567f,0.92627f,0.92686f,0.92745f,0.92803f,0.92862f,0.92920f,
        0.92978f,0.93035f,0.93093f,0.93150f,0.93207f,0.93264f,0.93320f,0.93377f,0.93433f,0.93489f,
        0.93544f,0.93600f,0.93655f,0.93710f,0.93765f,0.93819f,0.93873f,0.93927f,0.93981f,0.94035f,
        0.94088f,0.94141f,0.94194f,0.94247f,0.94299f,0.94351f,0.94403f,0.94455f,0.94506f,0.94558f,
        0.94609f,0.94659f,0.94710f,0.94760f,0.94810f,0.94860f,0.94910f,0.94959f,0.95008f,0.95057f,
        0.95106f,0.95154f,0.95202f,0.95250f,0.95298f,0.95345f,0.95393f,0.95440f,0.95486f,0.95533f,
        0.95579f,0.95625f,0.95671f,0.95717f,0.95762f,0.95807f,0.95852f,0.95897f,0.95941f,0.95985f,
        0.96029f,0.96073f,0.96117f,0.96160f,0.96203f,0.96246f,0.96288f,0.96330f,0.96372f,0.96414f,
        0.96456f,0.96497f,0.96538f,0.96579f,0.96620f,0.96660f,0.96700f,0.96740f,0.96780f,0.96819f,
        0.96858f,0.96897f,0.96936f,0.96974f,0.97013f,0.97051f,0.97088f,0.97126f,0.97163f,0.97200f,
        0.97237f,0.97274f,0.97310f,0.97346f,0.97382f,0.97417f,0.97453f,0.97488f,0.97523f,0.97557f,
        0.97592f,0.97626f,0.97660f,0.97693f,0.97727f,0.97760f,0.97793f,0.97826f,0.97858f,0.97890f,
        0.97922f,0.97954f,0.97986f,0.98017f,0.98048f,0.98079f,0.98109f,0.98139f,0.98169f,0.98199f,
        0.98229f,0.98258f,0.98287f,0.98316f,0.98345f,0.98373f,0.98401f,0.98429f,0.98456f,0.98484f,
        0.98511f,0.98538f,0.98564f,0.98591f,0.98617f,0.98643f,0.98669f,0.98694f,0.98719f,0.98744f,
        0.98769f,0.98793f,0.98817f,0.98841f,0.98865f,0.98889f,0.98912f,0.98935f,0.98958f,0.98980f,
        0.99002f,0.99024f,0.99046f,0.99068f,0.99089f,0.99110f,0.99131f,0.99151f,0.99172f,0.99192f,
        0.99211f,0.99231f,0.99250f,0.99269f,0.99288f,0.99307f,0.99325f,0.99343f,0.99361f,0.99379f,
        0.99396f,0.99413f,0.99430f,0.99447f,0.99463f,0.99479f,0.99495f,0.99511f,0.99526f,0.99541f,
        0.99556f,0.99571f,0.99585f,0.99599f,0.99613f,0.99627f,0.99640f,0.99654f,0.99667f,0.99679f,
        0.99692f,0.99704f,0.99716f,0.99728f,0.99739f,0.99750f,0.99761f,0.99772f,0.99782f,0.99793f,
        0.99803f,0.99812f,0.99822f,0.99831f,0.99840f,0.99849f,0.99857f,0.99866f,0.99874f,0.99881f,
        0.99889f,0.99896f,0.99903f,0.99910f,0.99917f,0.99923f,0.99929f,0.99935f,0.99940f,0.99946f,
        0.99951f,0.99955f,0.99960f,0.99964f,0.99968f,0.99972f,0.99976f,0.99979f,0.99982f,0.99985f,
        0.99988f,0.99990f,0.99992f,0.99994f,0.99996f,0.99997f,0.99998f,0.99999f,1.00000f,1.00000f,
        1.00000f,
};

/*!
 * Modulo (as opposed to remainder), per https://stackoverflow.com/a/19288271
 */
float fmodf_real(float dividend, float divisor){
    float rem = REM(dividend, divisor);
    return ((rem > 0)?rem:(rem + divisor));
}

/*!
 * Modulo (as opposed to remainder), per https://stackoverflow.com/a/19288271
 */
int mod_real(int dividend, int divisor){
    int rem = dividend % divisor;
    return ((rem >0)?rem:(rem + divisor));
}

/*!
    \brief     fast calculation of sine using look up table
    \param[in] x: angle in rad
    \retval    cosine in rad
*/
float fast_sin(float theta){
    // set theta to [0, 2PI]
    theta = fmodf_real(theta, PIx2);
    if(theta < PI){
        if(theta < PI_2){
            return sin_table[(int)(theta * SIN_TABLE_SIZE / PI_2)];
        }else{
            return sin_table[(int)((PI - theta) * SIN_TABLE_SIZE / PI_2)];
        }
    }else{
        if(theta < PIx3_2){
            return -sin_table[(int)((theta - PI) * SIN_TABLE_SIZE / PI_2)];
        }else{
            return -sin_table[(int)((PIx2 - theta) * SIN_TABLE_SIZE / PI_2)];
        }
    }
}

/*!
    \brief     fast calculation of cosine using look up table
    \param[in] x: angle in rad
    \retval    cosine in rad
*/
float fast_cos(float theta){
    return fast_sin(PI_2 - theta);
}

/*!
 * A fast sqrt algorithm
 * https://www.gamedev.net/forums/topic/704525-3-quick-ways-to-scMathulate-the-square-root-in-c/
 * @param[in] value to sqrt
 * @return sqrt(x)
 */
float fast_sqrt(const float x){
    int i = 0x2035AD0C + (*(int*)&x >> 1);
    return x / *(float*)&i + *(float*)&i * 0.25f;
}
